addpath('../ellip/');


N = 1e4;
t = 0.35;

Z = rand(N, 16);

lvl = 3:5;
rho = 0.9;
dt = 0.01;


[prob, mu, S] = MFCE(Z, t, @p, @f, lvl, N, rho, dt);


true_prob = 5e-3;

relerr = abs(true_prob - prob)/true_prob;

function vals = f(x, l)
    ops = load(['operatorsBlocks16_level',num2str(l),'.mat']);
    x = 9*x + 1;
    vals = ellip2DAffine(x,ops.ACell,ops.f,l);
end

function vals = p(x)
    vals = (prod(x >= zeros(size(x)) & x <= ones(size(x))) == 1);
end